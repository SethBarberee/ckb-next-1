#include "led.h"
#include "notify.h"
#include "profile.h"
#include "usb.h"

int updatergb_headset(usbdevice* kb, int force){
    if(!kb->active)
        return 0;
    lighting* lastlight = &kb->profile->lastlight;
    lighting* newlight = &kb->profile->currentmode->light;
    
    // Don't do anything if the lighting hasn't changed
    // Void has a single zone, so check only for "zone1"
    if(!force && !lastlight->forceupdate && !newlight->forceupdate
            && lastlight->r[0] == newlight->r[0]
            && lastlight->g[0] == newlight->g[0]
            && lastlight->b[0] == newlight->b[0])
        return 0;

    lastlight->forceupdate = newlight->forceupdate = 0;

    uchar staticrgb[10][20] =
    {
        { 0xcb, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
        { 0xcb, 0x01, 0x01, 0x15, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
        { 0xcb, 0x09, 0x1c, 0x00, 0x16, 0x00, 0x17, 0x00, 0x1d, 0x00, 0x18, 0x00, 0x19, 0x00, 0x1b, 0x00, 0x1a, 0x00, 0x1e, 0x00 },
        { 0xcb, 0x09, 0x4f, 0x00, 0x50, 0x9c, 0x51, 0x12, 0x52, 0x40, 0x53, 0x00, 0x54, 0x7e, 0x55, 0x00, 0x56, 0x7e, 0x57, 0x00 },
        { 0xcb, 0x09, 0x58, 0x44, 0x59, 0x00, 0x5a, 0xa0, 0x5b, 0x01, 0x5c, 0x9c, 0x5d, 0x13, 0x5e, 0x40, 0x5f, 0x00, 0x60, 0x7e },
        { 0xcb, 0x09, 0x61, 0x00, 0x62, 0x7e, 0x63, 0x00, 0x64, 0x44, 0x65, 0x00, 0x66, 0xa0, 0x67, 0x01, 0x68, 0x9c, 0x69, 0x14 },
        { 0xcb, 0x09, 0x6a, 0x40, 0x6b, 0x00, 0x6c, 0x7e, 0x6d, 0x00, 0x6e, 0x7e, 0x6f, 0x00, 0x4f, 0x01, 0x50, 0x44, 0x51, 0x00 },
        { 0xcb, 0x08, 0x52, 0xa0, 0x53, 0x01, 0x54, 0x00, 0x55, 0xc0, 0x56, 0x00, 0x57, 0x05, 0x58, 0x00, 0x59, 0x0a, 0x00, 0x00 },
        { 0xcb, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
        { 0xcb, 0x05, 0x4c, 0x00, 0x4d, 0x06, 0x4e, 0x0c, 0x01, 0x2a, 0x00, 0x6a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }  
    };

    // Red
    staticrgb[3][11] = newlight->r[0];
    // Green
    staticrgb[4][17] = newlight->g[0];
    // Blue
    staticrgb[6][5] = newlight->b[0];

    // Send RGB data
    if(!usbsend(kb, staticrgb[0], 10, 20))
        return -1;

    memcpy(lastlight, newlight, sizeof(lighting));
    return 0;
}
